/*******************************************************************************************************************************//**
 *
 * @file		inicializar.cpp
 * @brief		Descripcion del modulo
 * @date		5 jul. 2022
 * @author		Ing. Marcelo Trujillo
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "systick.h"

using namespace std;
/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/
#define MAX_TICKS 	0xffffff

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** OBJETOS GLOBALES PUBLICOS
 *********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/
volatile void (*SysTickCallback)(void) = nullptr ;

void SysTick_Handler(void)
{
	if ( SysTickCallback )
		SysTickCallback();
}

void SysTick_CallBack_Install(void (*CallBack)(void))
{
	 SysTickCallback = (volatile void (*)(void))CallBack;
}

uint32_t Inicializar_SysTick( uint32_t ms )
{
	uint32_t FrecuenciaSystick , ticks ;
	FrecuenciaSystick = ms * 1000 ;				 	// FrecuenciaSystick = 1 / ( ms * 0.001)

	ticks = FREQ_CLOCK / FrecuenciaSystick;  		// ticks = Tsystic / Tclock ;

	if (ticks > MAX_TICKS)
		return 1 ;          		//* Reload value fuera de rango

	SysTick->RELOAD = ticks - 1;  	//* Cargamos la Cuenta

	SysTick->CURR = 0;   			//* SysTick Counter en 0 para que se recargue

	SysTick->CTRL = 7;	// ENABLE = 1, TICKINT = 1, CLKSOURCE = 1;

	return 0;
}
